<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_class_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <style>
                    table {
                    font-family: arial, sans-serif;
                    border-collapse: collapse;
                    width: 100%;
                    }
                    td, th {
                    border: 1px solid #dddddd;
                    text-align: left;
                    padding: 8px;
                    }
                    tr:nth-child(even) {
                    background-color: #dddddd;
                    }
                </style>
                <div t-foreach="lines" t-as="r">
                    <div>
                        <center>
                            <h2>
                                <span t-esc="r['name']"/>
                                : Mark Sheet
                            </h2>
                            <h4>
                                <span t-esc="r['course']"/>
                                -
                                <span t-esc="r['academic_year']"/>
                            </h4>
                        </center>
                        <br/>
                        <div>
                            <b>Exam:</b>
                            <span t-esc="r['exam_name']"/>
                        </div>
                        <div>
                            <div>
                                <b>Total:</b>
                                <t t-set="t" t-value="0"/>
                                <span t-foreach="data1" t-as="d">
                                    <t t-if="d['exam_id'] == r['id']">
                                        <t t-set="t" t-value="t + 1"/>
                                    </t>
                                </span>
                                <span t-esc="t"/>
                            </div>
                            <div>
                                <b>Pass:</b>
                                <t t-set="p" t-value="0"/>
                                <span t-foreach="data1" t-as="d">
                                    <t t-if="d['pass_fail'] == true and d['exam_id'] == r['id']">
                                        <t t-set="p" t-value="p + 1"/>
                                    </t>
                                </span>
                                <span t-esc="p"/>
                            </div>
                            <div>
                                <b>Fail:</b>
                                <t t-set="f" t-value="0"/>
                                <span t-foreach="data1" t-as="d">
                                    <t t-if="not d['pass_fail'] == true and d['exam_id'] == r['id']">
                                        <t t-set="f" t-value="f + 1"/>
                                    </t>
                                </span>
                                <span t-esc="f"/>
                            </div>
                            <div>
                                <b>Ratio:</b>
                                <span t-esc="p/t *100"/>%
                            </div>
                        </div>
                        <br/>
                    </div>
                    <table>
                        <tr>
                            <th>Student Name</th>
                            <div t-foreach="data2" t-as="e">
                                <t t-if="e['marklist_id'] == data1[0]['id']">
                                    <th t-esc="e['subject']"/>
                                </t>
                            </div>
                            <th>Obtained Mark</th>
                            <th>Total Mark</th>
                            <th>Pass/Fail</th>
                        </tr>
                        <div t-foreach="data1" t-as="ml">
                            <t t-if="ml['exam_id'] == r['id']">
                                <tr>
                                    <td>
                                        <div t-esc="ml['student_name']"/>
                                    </td>

                                    <div t-foreach="data2" t-as="md">
                                        <t t-if="md['marklist_id'] == ml['id']">
                                            <td>
                                                <t t-if="md['mark']">
                                                    <span t-esc="md['mark']"/>
                                                </t>
                                                <t t-if="not md['mark']">
                                                    0
                                                </t>
                                            </td>
                                        </t>
                                    </div>
                                    <td>
                                        <div t-esc="ml['total']"/>
                                    </td>
                                    <t t-set="i" t-value="0.0"/>
                                    <td>
                                        <div t-foreach="data2" t-as="d">
                                            <t t-set="i" t-value="i + d['max_mark']"/>
                                        </div>
                                        <span t-esc="i"/>
                                    </td>
                                    <td>
                                        <t t-if="ml['pass_fail'] == true">
                                            <div>PASS</div>
                                        </t>
                                        <t t-if="not ml['pass_fail']">
                                            <div>FAIL</div>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                        </div>
                    </table>
                </div>
            </t>
        </t>
    </template>
</odoo>
